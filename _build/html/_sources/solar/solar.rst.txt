Solar tools
===========

Solar position
--------------
The solar position is based on the work of Reda & Andreas :cite:p:`reda_solar_2008` which includes the Meeus
:cite:p:`meeus_astronomical_1998` and Iqbal :cite:p:`iqbal_introduction_1983` algorithms. For more details on the
solar position algorithm, refer to `Reda and Andreas <https://www.nrel.gov/docs/fy08osti/34302.pdf>`_. The algorithm
use the earth Δt and Universal Time (UTC) fro time correction. For more information on Δt and Universal Time, see
`Nasa <https://eclipse.gsfc.nasa.gov/SEhelp/deltaT.html>`_.

Bird's Clear Sky
----------------
Brird's clear sky irradiation model is based on work of Bird :cite:p:`bird_simplified_1981`. For more details on the
Bird's algorithm, refer to `Bird <https://www.nrel.gov/grid/solar-resource/assets/data/tr-642-761.pdf>`_.


Climatology
===========
The probabilistic forecasts in this package use Clear Sky Indexes :math:`CSI` and clear sky data
:math:`GHI_{\text{Clear Sky}}`.

.. math:: CSI=\frac{GHI}{GHI_{\text{Clear Sky}}}


The climatology can be computed in two ways:
    #. A distribution is generated from all clear sky indices (:math:`\phi=ecdf(CSI)`).
        The forecast is generated based on this single empirical distribution.
    #. For each time slot, an empirical distribution (ecdf) is generated (:math:`\phi_t=ecdf(CSI_t)`).
        For example, if there are 10 hours  in a day, 10 CSI distributions will be generated. Forecasts for each time
        range will be generated by its own distribution.

.. note::
    CSI data is filtered with two main parameters:
        #. The zenith angle, all data corresponding to angles greater than this value will be ignored.
            The default value is set to 86°
        #. The maximum CSI value: Values greater than :math:`CSI_{max}` will be replaced by :math:`CSI_{max}`.
            The maximum value is calculated as the minimum of the user-defined (:math:`CSI_{\text{user}}`) and the
            fraction (:math:`f_0 \leq 1`) of extraterrestrial solar radiation (:math:`E_0=1367 Wm^{-2}`) reaching the
            Earth's surface divided by the max value of the global horizontal irradiation :math:`GHI`.

            .. math:: CSI_{max}=min\left(CSI_{user},\frac{E_0 \times f_0}{max({GHI})}\right)


    The climatology computation rely on :meth:`solar.ecdf0`